#!/usr/bin/env bash

# Base path (default: ~/.config/i3)
BASE_DIR="${XDG_CONFIG_HOME:-$HOME/.config}/i3"
MODULES_DIR="$BASE_DIR/i3blocks"
HEADER_FILE="$MODULES_DIR/header.conf"
OUTPUT_FILE="$BASE_DIR/i3blocks.conf"

# Safety checks
if [[ ! -f "$HEADER_FILE" ]]; then
  echo "❌ Missing header file: $HEADER_FILE"
  exit 1
fi

if [[ ! -d "$MODULES_DIR" ]]; then
  echo "❌ Modules directory does not exist: $MODULES_DIR"
  exit 1
fi

# Build config
{
  cat "$HEADER_FILE"
  echo ""
  for module in "$MODULES_DIR"/*.conf; do
    [[ -f "$module" && "$module" != "$HEADER_FILE" ]] || continue
    echo "# ---- $(basename "$module") ----"
    cat "$module"
    echo ""
  done
} > "$OUTPUT_FILE"

echo "✅ i3blocks config generated at: $OUTPUT_FILE"
