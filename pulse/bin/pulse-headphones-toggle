#!/usr/bin/env bash

# Define the sink names for Speaker and Headphones
speaker_sink="alsa_output.pci-0000_00_1f.3-platform-skl_hda_dsp_generic.HiFi__Speaker__sink"
headphones_sink="alsa_output.pci-0000_00_1f.3-platform-skl_hda_dsp_generic.HiFi__Headphones__sink"

# Define the card and profiles
card_name="alsa_card.pci-0000_00_1f.3-platform-skl_hda_dsp_generic"
profile_headphones="HiFi (HDMI1, HDMI2, HDMI3, Headphones, Mic1, Mic2)"
profile_speaker="HiFi (HDMI1, HDMI2, HDMI3, Mic1, Mic2, Speaker)"

# Get the current default sink
current_sink=$(pactl info | awk -F': ' '/Default Sink/ {print $2}')

# Decide which sink and profile to switch to
if [ "$current_sink" = "$headphones_sink" ]; then
    target_sink="$speaker_sink"
    target_profile="$profile_speaker"
    notify_msg="Switching to Speaker"
else
    target_sink="$headphones_sink"
    target_profile="$profile_headphones"
    notify_msg="Switching to Headphones"
fi

# Set the card profile
pactl set-card-profile "$card_name" "$target_profile"

# Set the default sink
pactl set-default-sink "$target_sink"

# Wait a moment to ensure the sink is available
sleep 0.5

echo "[DEBUG] Sink-inputs before move:"
pactl list short sink-inputs

echo "[DEBUG] Moving all sink-inputs to $target_sink..."
for input in $(pactl list short sink-inputs | awk '{print $1}'); do
    echo "[DEBUG] Moving sink-input $input to $target_sink"
    pactl move-sink-input "$input" "$target_sink"
done

echo "[DEBUG] Sink-inputs after move:"
pactl list short sink-inputs

notify-send "PulseAudio Toggle" "$notify_msg" 