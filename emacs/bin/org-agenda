#!/bin/bash

# Start listening for window events in background
swaymsg -t subscribe -m '["window"]' | while read event; do
    if echo "$event" | jq -e '.change == "new" and (.container.window_properties.class == "Emacs" or .container.app_id == "emacs")' >/dev/null 2>&1; then
        window_id=$(echo "$event" | jq -r '.container.id')
        swaymsg "[con_id=$window_id] floating enable; resize set 90 ppt 90 ppt; move position center"
        break
    fi
done &

# Launch emacs
DISPLAY=:0 emacsclient -c -F '((name . "Floating Agenda"))' --eval "(progn (org-agenda nil \"a\") (delete-other-windows))"
