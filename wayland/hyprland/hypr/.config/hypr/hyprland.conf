# Hyprland configuration
# Drop-in replacement for Sway with same keybindings

# Source theme
source = ~/.config/hypr/catppuccin-mocha-theme.conf

# See https://wiki.hyprland.org/Configuring/Monitors/
# Monitor configuration - stable identification by make/model
#monitor=desc:Dell Inc. DELL P2715Q,3840x2160@60,0x0,1.0
monitor=desc:Dell Inc. DELL P2715Q,1920x1080@60,0x0,1.0
monitor=eDP-1,1920x1200@60,1920x0,1.0
# Execute on launch
exec-once = systemctl --user import-environment DISPLAY WAYLAND_DISPLAY
exec-once = systemctl --user start hyprland-session.target

# Launch startup applications
exec-once = kitty --title "Terminal"
exec-once = emacs --title "Emacs"
exec-once = chatgpt-web
exec-once = gmail-personal
exec-once = outlook-work-email
exec-once = outlook-work-calendar

# Environment variables
env = XCURSOR_SIZE,24

# Input configuration
input {
    kb_layout = us,gr
    kb_options = grp:alt_shift_toggle

    follow_mouse = 1

    touchpad {
        natural_scroll = false
    }

    sensitivity = 0
}

# General settings
general {
    gaps_in = 20
    gaps_out = 20
    border_size = 4

    layout = dwindle

    allow_tearing = false
}

# Decoration (visual effects)
decoration {
    rounding = 10

    blur {
        enabled = true
        size = 3
        passes = 1
        vibrancy = 0.1696
    }

    # Shadow options removed in newer Hyprland versions
    # drop_shadow = true
    # shadow_range = 20
    # shadow_render_power = 3
    # shadow_offset = 8 8
}

# Animations
animations {
    enabled = true

    bezier = myBezier, 0.05, 0.9, 0.1, 1.05

    animation = windows, 1, 7, myBezier
    animation = windowsOut, 1, 7, default, popin 80%
    animation = border, 1, 10, default
    animation = borderangle, 1, 8, default
    animation = fade, 1, 7, default
    animation = workspaces, 1, 6, default
}

# Layout configuration
dwindle {
    pseudotile = true
    preserve_split = true
}

master {
    new_status = master
}

# Window rules
# Floating Apps

# Nitrogen
windowrulev2 = float, class:(Nitrogen)
windowrulev2 = size 50% 50%, class:(Nitrogen)
windowrulev2 = center, class:(Nitrogen)

# K9s
windowrulev2 = float, title:(k9s)
windowrulev2 = size 80% 80%, title:(k9s)
windowrulev2 = center, title:(k9s)

# AlsaMixer
windowrulev2 = float, title:(alsamixer)

# Bluetooth manager
windowrulev2 = float, class:(blueman-manager)
windowrulev2 = center, class:(blueman-manager)

# ytop
windowrulev2 = float, title:(ytop)

# EditorTerm - IDE-like layout

#windowrulev2 = size 100% 25%, title:(Auxiliary Terminal)
#windowrulev2 = move 0 75%, title:(Auxiliary Terminal)

#
# Emacs floating app
#
windowrulev2 = float, title:(emacs-floating-)
windowrulev2 = size 95% 90%, title:(emacs-floating-)
windowrulev2 = center, title:(emacs-floating-)

# Agenda
windowrulev2 = float, title:(Floating Agenda)
windowrulev2 = size 95% 90%, title:(Floating Agenda)
windowrulev2 = center, title:(Floating Agenda)

# Journal
windowrulev2 = float, title:(Floating Journal)
windowrulev2 = size 95% 90%, title:(Floating Journal)
windowrulev2 = center, title:(Floating Journal)

# Org Capture
windowrulev2 = float, title:(Floating Org Capture)
windowrulev2 = size 95% 90%, title:(Floating Org Capture)
windowrulev2 = center, title:(Floating Org Capture)

# Org Roam Capture
windowrulev2 = float, title:(Floating Org Roam Capture)
windowrulev2 = size 95% 90%, title:(Floating Org Roam Capture)
windowrulev2 = center, title:(Floating Org Roam Capture)

# Capture Meals
windowrulev2 = float, title:(Floating Capture Meals)
windowrulev2 = size 95% 90%, title:(Floating Capture Meals)
windowrulev2 = center, title:(Floating Capture Meals)

# Workspace assignment rules
windowrulev2 = workspace 1, class:(MainTerminal)
windowrulev2 = workspace 2, class:(chrome-gmail.com.*)
windowrulev2 = workspace 3, class:(chrome-outlook.office.com__email.*)
windowrulev2 = workspace 4, class:(chrome-outlook.office.com__calendar.*)
windowrulev2 = workspace 5, class:(Slack)
windowrulev2 = workspace 5, class:(Zulip)
windowrulev2 = workspace 6, title:(ChatGPT)
windowrulev2 = workspace 7, title:(Workspace Emacs)

# Variables
$mainMod = SUPER

# Keybindings - matching Sway exactly

# Terminal
bind = $mainMod, Return, exec, kitty
bind = $mainMod, U, exec, sh -lc '\
  hyprctl keyword general:layout master; \
  pid="$(hyprctl activewindow -j | jq -r .pid)"; \
  dir="$(readlink -f /proc/$pid/cwd 2>/dev/null || printf "%s" "$HOME")"; \
  hyprctl dispatch layoutmsg orientationtop; \
  hyprctl dispatch layoutmsg mfact exact 0.75; \
  kitty --title "Auxiliary Terminal" --directory $dir & \
  sleep 0.15; \
  hyprctl dispatch layoutmsg swapwithmaster auto \
'

# Browser
bind = $mainMod, B, exec, qutebrowser

# Kill window
bind = $mainMod SHIFT, Q, killactive
bind = $mainMod SHIFT, Y, killactive

# Launchers
bind = $mainMod, D, exec, wofi --show drun --show-icons --prompt "Launch"
bind = $mainMod, semicolon, exec, wofi --show drun --show-icons --prompt "Launch"
bind = $mainMod, G, exec, qutebrowser-google-wofi
bind = $mainMod, W, exec, hyprland-window-switcher

# Clipboard
bind = $mainMod, C, exec, wofi-cliphist
bind = $mainMod SHIFT, C, exec, wofi-cliphist-primary
bind = $mainMod, P, exec, CM_LAUNCHER="wofi" wofi-pass

# Focus management
bind = $mainMod, J, movefocus, l
bind = $mainMod, K, movefocus, d
bind = $mainMod, L, movefocus, u
bind = $mainMod, Left, movefocus, l
bind = $mainMod, Down, movefocus, d
bind = $mainMod, Up, movefocus, u
bind = $mainMod, Right, movefocus, r

# Move windows
bind = $mainMod SHIFT, J, movewindow, l
bind = $mainMod SHIFT, K, movewindow, d
bind = $mainMod SHIFT, L, movewindow, u
bind = $mainMod SHIFT, semicolon, movewindow, r
bind = $mainMod SHIFT, Left, movewindow, l
bind = $mainMod SHIFT, Down, movewindow, d
bind = $mainMod SHIFT, Up, movewindow, u
bind = $mainMod SHIFT, Right, movewindow, r

# Split orientation
bind = $mainMod, H, togglesplit
bind = $mainMod, V, togglesplit

# Fullscreen
bind = $mainMod SHIFT, F, fullscreen, 0

# Layout modes
bind = $mainMod, S, exec, hyprctl keyword general:layout master
bind = $mainMod, E, togglesplit
bind = $mainMod, V, layoutmsg, splitv
bind = $mainMod, H, layoutmsg, splith

# Toggle floating
bind = $mainMod SHIFT, Space, togglefloating
bind = $mainMod SHIFT, Space, exec, hyprctl dispatch resizeactive exact 90% 90%
bind = $mainMod SHIFT, Space, centerwindow

# Focus mode toggle
bind = $mainMod, Space, focusmonitor, +1

# Org mode shortcuts
bind = $mainMod SHIFT, A, exec, ~/bin/org-agenda
bind = $mainMod CTRL, C, exec, ~/bin/org-capture
bind = $mainMod SHIFT, R, exec, ~/bin/org-roam-capture
bind = $mainMod SHIFT, J, exec, ~/bin/org-roam-dailies-goto-today
bind = $mainMod SHIFT, E, exec, ~/bin/elfeed
bind = $mainMod SHIFT, M, exec, ~/bin/mu4e

# Audio control
bind = $mainMod CTRL, A, exec, kitty --title alsamixer -e alsamixer
bind = $mainMod, A, exec, pwvucontrol  # Pipewire audio control

# Bluetooth
bind = $mainMod CTRL, B, exec, blueman-manager
bind = $mainMod SHIFT, B, exec, toggle-blueman-applet

# System monitor
bind = $mainMod CTRL, T, exec, kitty --title ytop -e ytop

# Notifications
bind = CTRL, grave, exec, swaync-client -t -sw

# Network Manager
bind = $mainMod SHIFT, N, exec, toggle-nm-applet

# Switch to workspace
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10

# Move active window to workspace
bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4
bind = $mainMod SHIFT, 5, movetoworkspace, 5
bind = $mainMod SHIFT, 6, movetoworkspace, 6
bind = $mainMod SHIFT, 7, movetoworkspace, 7
bind = $mainMod SHIFT, 8, movetoworkspace, 8
bind = $mainMod SHIFT, 9, movetoworkspace, 9
bind = $mainMod SHIFT, 0, movetoworkspace, 10

# Move workspace to monitor
bind = $mainMod CTRL, Right, movecurrentworkspacetomonitor, +1
bind = $mainMod CTRL, Left, movecurrentworkspacetomonitor, -1

# Hyprland control
bind = $mainMod CTRL, L, exec, hyprctl reload
bind = $mainMod CTRL, R, exec, hyprctl reload

# Screenshots
bind = $mainMod SHIFT, P, exec, flameshot gui
bind = CTRL SHIFT, P, exec, hyprland-screenshot-region
bind = $mainMod SHIFT, S, exec, toggle-screenkey

# Screen lock
bind = $mainMod CTRL SHIFT, S, exec, toggle-screenlock

# Monitor toggle
bind = $mainMod CTRL, S, exec, toggle-monitor

# Emacs daemon
bind = $mainMod CTRL SHIFT, E, exec, restart-emacsd

# Temporary workaround
bind = $mainMod SHIFT, W, exec, file-cache-conflict-resolve

# Resize mode
bind = $mainMod, R, submap, resize
submap = resize

binde = , J, resizeactive, -10 0
binde = , K, resizeactive, 0 10
binde = , L, resizeactive, 0 -10
binde = , semicolon, resizeactive, 10 0
binde = , Left, resizeactive, -10 0
binde = , Down, resizeactive, 0 10
binde = , Up, resizeactive, 0 -10
binde = , Right, resizeactive, 10 0

bind = , Return, submap, reset
bind = , Escape, submap, reset
submap = reset

# Resize with SUPER+ALT+arrows (repeat while held)
binde = SUPER ALT, left,  resizeactive, -20 0
binde = SUPER ALT, right, resizeactive,  20 0
binde = SUPER ALT, up,    resizeactive,  0 -20
binde = SUPER ALT, down,  resizeactive,  0  20

# Mouse bindings
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# = Source for hyprviz
source = ./hyprviz.conf
